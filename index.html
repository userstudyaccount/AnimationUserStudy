<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Animation Comparison Study</title>
  <script src="jspsych/jspsych.js"></script>
	<script src="jspsych/plugin-html-keyboard-response.js"></script>
	<script src="jspsych/plugin-image-keyboard-response.js"></script>
	<script src="jspsych/plugin-video-button-response.js"></script>
  <script src="jspsych/plugin-html-button-response.js"></script>
  <script src="jspsych/plugin-survey-html-form.js"></script>
  <script src="jspsych/plugin-preload.js"></script>
  <script src="user_study_text.js"></script>
  <link href="jspsych/jspsych.css" rel="stylesheet" type="text/css" />
	<style>
    video { width: 300px; margin: 10px; }
    .video-container { display: flex; justify-content: center; }
    .ranking-form { text-align: center; margin-top: 20px; }
  </style>
</head>
<body></body>
<script>
	var jsPsych = initJsPsych({

	});

	var total_clips = 50;
	var clips = Array.from({ length: total_clips }, (_, i) => i);
	var models = ["style_gt", "mp", "smoodi", "ours"];
	var model_ids_1 = ['A', 'C'];
	var model_ids_2 = ['A', 'C'];

	const participant_id = jsPsych.randomization.randomID(8);


	var timeline = [
  {
    type: jsPsychPreload,
    video: clips.flatMap(clip => models.map(m => `stimuli/${m}_${clip}.mp4`))
  }
];

	var welcome = {
		type: jsPsychHtmlKeyboardResponse,
		stimulus:
		`<h2 style="text-align: center;"> Animation User Study</h2>
		<div style="max-width: 600px; margin: 0 auto; text-align: left;">
			<p> This study is to evaluate different models for a Siggraph-Asia submission. The survey should take about 10 - 15 mins. We appreciate your participation.</p>
			In this study, you will be shown a series of videos generated by three different models.
			On each page, you are given a text description that describe content of the motion, and a reference video that shows the style of the motion. Two models will be shown at a time,
			and your task is to choose your preferred model based on how well they preserve the semantic meaning of the text description and reflect the style of the reference motion, as well as their motion quality (considering artifacts such as foot sliding, jittering, etc).</p>
			<p><strong>Press any key to begin.</strong></p>

		</div>`,
		post_trial_gap: 2000
	};
	timeline.push(welcome);


	function submitDataAndEndExperiment() {
		const submissionURL = 'https://script.google.com/macros/s/AKfycbxYKVLrRzImimHl7FTD8Wa9EdssXpQcBvVoAyOvadKLKwwY4Ozc45AH20uG7AQwYeyJRg/exec';

		const trial_data = jsPsych.data.get().filter({ task: "user_response" }).values();

		fetch(submissionURL, {
			method: 'POST',
			mode: 'no-cors',
			headers: {
				'Content-Type': 'application/json',
			},
			body: JSON.stringify({
				participant_id: participant_id,
				values: trial_data
			})
		});

		jsPsych.endExperiment("Your data has been submitted. Thank you!");
	}


	clips.forEach((clip_id, index) => {
		const model_order = models;
		const top_video_html = `<div>
			<strong>Style</strong>
			<video controls autoplay muted loop><source src='stimuli/style_gt_${clip_id}.mp4' type='video/mp4'></video></div>`;
		const bottom_videos_html_1 =
			`
			<div class='video-container'>
			<div><video controls autoplay muted loop><source src='stimuli/mp_${clip_id}.mp4' type='video/mp4'></video></div>
			<div><video controls autoplay muted loop><source src='stimuli/ours_${clip_id}.mp4' type='video/mp4'></video></div>
			</div>`;
		const bottom_videos_html_2 =
			`
			<div class='video-container'>
			<div><video controls autoplay muted loop><source src='stimuli/smoodi_${clip_id}.mp4' type='video/mp4'></video></div>
			<div><video controls autoplay muted loop><source src='stimuli/ours_${clip_id}.mp4' type='video/mp4'></video></div>
			</div>`;

		const titles = ["Content preservation", "Style reflection", "Motion quality"]

		const trial_1 = {
			type: jsPsychSurveyHtmlForm,
			preamble: `<h3> Sample ${clip_id+1}/${total_clips}, task 0/1: ${userStudyText[clip_id]}</h3>
			${top_video_html}${bottom_videos_html_1}`,
			html: `
				<p>Compare the following two models:</p>
				<div class="ranking-container" style="display: flex; flex-direction: column; justify-content: center; gap: 30px;">
					${titles.map((title, i) => `
						<div class="ranking-row" style="display: flex; align-items: center; border: 1px solid #ccc; padding: 10px; width: 600px;">
							<div style="width: 200px; font-weight: bold;">${title}</div>
							<div style="display: flex; gap: 20px;">
								<label style="font-size: 18px; display: flex; align-items: center; gap: 8px;">
									<input style="transform: scale(1.5);" name="clip_${clip_id}_model_mp_q_${i}" type="radio" value="0" required> Left
								</label>
								<label style="font-size: 18px; display: flex; align-items: center; gap: 8px;">
									<input style="transform: scale(1.5);" name="clip_${clip_id}_model_mp_q_${i}" type="radio" value="1"> Right
								</label>
							</div>
						</div>
					`).join("")}
				</div>
			`,
			data: {
				task: 'user_response',
				clip_id: clip_id,
				model: "MP",
			}
		};
		const trial_2 = {
			type: jsPsychSurveyHtmlForm,
			preamble: `<h3> Sample ${clip_id+1}/${total_clips}, task 1/1: ${userStudyText[clip_id]}</h3>
			${top_video_html}${bottom_videos_html_2}`,
			html: `
				<p>Compare the following two models, and choose the one you prefer:</p>
				<div class="ranking-container" style="display: flex; flex-direction: column; justify-content: center; gap: 30px;">
					${titles.map((title, i) => `
						<div class="ranking-row" style="display: flex; align-items: center; border: 1px solid #ccc; padding: 10px; width: 600px;">
							<div style="width: 200px; font-weight: bold;">${title}</div>
							<div style="display: flex; gap: 20px;">
								<label style="font-size: 18px; display: flex; align-items: center; gap: 8px;">
									<input style="transform: scale(1.5);" name="clip_${clip_id}_model_smoodi_q_${i}" type="radio" value="0" required> Left
								</label>
								<label style="font-size: 18px; display: flex; align-items: center; gap: 8px;">
									<input style="transform: scale(1.5);" name="clip_${clip_id}_model_smoodi_q_${i}" type="radio" value="1"> Right
								</label>
							</div>
						</div>
					`).join("")}
				</div>
			`,
			data: {
				task: 'user_response',
				clip_id: clip_id,
				model: "SMOODI",
			}
		};

		timeline.push([trial_1, trial_2]);
	});



	timeline.push({
		type: jsPsychHtmlButtonResponse,
		stimulus: '<p>Thank you for participating!</p><p>Your data is being submitted...</p>',
		choices: ['Finish'],
		on_finish: submitDataAndEndExperiment
	});


	jsPsych.run(timeline);


</script>
</html>